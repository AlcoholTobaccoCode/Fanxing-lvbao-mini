<!--
@description: AI Ê∂àÊÅØÂÆπÂô®ÁªÑ‰ª∂
-->
<script lang="ts" setup>
import { computed } from "vue";
import ZeroMarkdownView from "../zero-markdown-view/components/zero-markdown-view/zero-markdown-view.vue";

interface Props {
	content?: string;
	// Ê∑±Â∫¶ÊÄùËÄÉÁõ∏ÂÖ≥
	deepThink?: string;
	deepThinkStartTime?: number;
	deepThinkEndTime?: number;
	deepThinkExpanded?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
	deepThinkExpanded: true
});

const emit = defineEmits<{
	(e: "toggle-deep-think"): void;
}>();

// ËÆ°ÁÆóÊÄùËÄÉÁî®Êó∂ÊñáÊ°à
const deepThinkTimeText = computed(() => {
	if (!props.deepThink) return "";

	if (props.deepThinkEndTime && props.deepThinkStartTime) {
		const seconds = Math.round((props.deepThinkEndTime - props.deepThinkStartTime) / 1000);
		return `ÊÄùËÄÉÔºàÁî®Êó∂ ${seconds} ÁßíÔºâ`;
	}

	return "ÊÄùËÄÉ‰∏≠...";
});

const handleToggle = () => {
	emit("toggle-deep-think");
};
</script>

<template>
	<view class="ai-message px-4 my-2">
		<!-- Ê∑±Â∫¶ÊÄùËÄÉÂ±ïÁ§∫ -->
		<view v-if="deepThink" class="deepthink-wrapper">
			<view class="deepthink-header" @tap.stop="handleToggle">
				<view class="deepthink-icon">
					<cl-text>üí≠</cl-text>
				</view>
				<text class="deepthink-title">{{ deepThinkTimeText }}</text>
				<text class="deepthink-toggle">
					<cl-icon :name="`arrow-${deepThinkExpanded ? 'up-s-line' : 'down-s-line'}`" />
				</text>
			</view>
			<view v-if="deepThinkExpanded" class="deepthink-body">
				<text class="deepthink-text">{{ deepThink }}</text>
			</view>
		</view>

		<!-- ÂâçÁΩÆÊèíÊßΩÔºàÈò∂ÊÆµËøõÂ∫¶Á≠âÔºâ -->
		<slot name="prepend"></slot>

		<!-- Markdown ÂÜÖÂÆπ -->
		<template v-if="content">
			<zero-markdown-view :markdown="content" :aiMode="true" />
		</template>

		<!-- È¢ùÂ§ñÂÜÖÂÆπÊèíÊßΩÔºàÂºïÁî®„ÄÅÊé®ËçêÁ≠âÔºâ -->
		<slot></slot>
	</view>
</template>

<style lang="scss" scoped>
.ai-message {
	@apply w-full box-border;
}

.deepthink-wrapper {
	@apply mt-3 mb-1;
}

.deepthink-header {
	@apply flex flex-row items-center mb-1;
}

.deepthink-icon {
	border-radius: 999px;
	margin-right: 6px;
}

.deepthink-title {
	@apply text-sm mr-1;
	color: #3b82f6;
}

.deepthink-toggle {
	@apply text-sm;
	color: #9ca3af;
}

.deepthink-body {
	@apply mt-1 pl-3 border-l;
	border-color: #e5e7eb;
}

.deepthink-text {
	@apply text-sm leading-relaxed;
	color: #6b7280;
}
</style>
